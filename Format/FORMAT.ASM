M0000	EQU	0000H
M0008	EQU	0008H
M0020	EQU	0020H
M0023	EQU	0023H
M0033	EQU	0033H
M0040	EQU	0040H
M0060	EQU	0060H
M00BA	EQU	00BAH
M00CD	EQU	00CDH
M0100	EQU	0100H
M0206	EQU	0206H
M1000	EQU	1000H
M1720	EQU	1720H
M199D	EQU	199DH
M37B6	EQU	37B6H
M37E1	EQU	37E1H
M37EC	EQU	37ECH
M37EE	EQU	37EEH
M37EF	EQU	37EFH
M3840	EQU	3840H
M4030	EQU	4030H
M41FC	EQU	41FCH
M4200	EQU	4200H
M4202	EQU	4202H
M4275	EQU	4275H
M429A	EQU	429AH
M42AA	EQU	42AAH
M42B2	EQU	42B2H
M42E2	EQU	42E2H
M42E5	EQU	42E5H
M42F1	EQU	42F1H
M430F	EQU	430FH
M4467	EQU	4467H
M4D00	EQU	4D00H
M4D16	EQU	4D16H
M4DFF	EQU	4DFFH
M5B9C	EQU	5B9CH
M5BC0	EQU	5BC0H
M5C00	EQU	5C00H
M5C60	EQU	5C60H
M5D00	EQU	5D00H
M5D02	EQU	5D02H
M5D05	EQU	5D05H
M5F00	EQU	5F00H
M5F3E	EQU	5F3EH
M8000	EQU	8000H
MA100	EQU	0A100H
MEACB	EQU	0EACBH
MF397	EQU	0F397H
MF413	EQU	0F413H
MFFFF	EQU	0FFFFH

	ORG	5200H
M5200	DI
	LD	SP,M41FC
	PUSH	HL
	LD	A,(M4030)
	CP	0C7H
	JR	Z,M521C
	LD	A,(M430F)
	BIT	5,A
	JR	Z,M521C
	LD	HL,M57C0
	CALL	M4467
	JP	M4030
M521C	LD	HL,M5E00
	LD	DE,M4200
	LD	BC,M0100
	LDIR
	LD	HL,M57E8
	CALL	M429A
	POP	HL
M522E	LD	HL,M580E	; ask "WHICH DRIVE IS TO BE USED ?"
	CALL	M429A
	LD	HL,M5D00
	LD	B,01H
	CALL	M0040
	LD	A,(HL)
	SUB	'0'
	JP	C,M522E
	CP	04H
	JP	NC,M522E
	RLCA
	RLCA
	RLCA
	OR	0C7H
	LD	(M5251),A
	XOR	A
	SET	0,A
M5251	EQU	$-1
	LD	(M5768),A
	CALL	M5767
	CALL	M5754
	LD	BC,M0000
	CALL	M0060
M5261	LD	A,(M37EC)
	BIT	0,A
	JR	NZ,M5261
	LD	HL,M586B
	BIT	7,A
	JP	NZ,M56AD
	LD	HL,M5896
	BIT	2,A
	JP	Z,M56AD
M5278	LD	HL,M582B	; ask "DISKETTE NAME ?"
	CALL	M429A
	LD	HL,M5778
	LD	DE,M5CD0
	LD	BC,M0008
	LDIR
	LD	HL,M5D00
	LD	B,08H
	CALL	M0040
	LD	A,B
	OR	A
	JR	Z,M5278
	LD	C,B
	LD	B,00H
	LD	DE,M5CD0
	LDIR
M529D	LD	HL,M583C	; ask "CREATION DATE MM/DD/YY) ?"
	CALL	M429A
	LD	HL,M5D00
	LD	B,08H
	CALL	M0040
	LD	A,B
	CP	08H
	JP	NZ,M529D
	LD	A,(M5D02)
	CP	'/'
	JP	NZ,M529D
	LD	A,(M5D05)
	CP	'/'
	JP	NZ,M529D
	LD	C,B
	LD	B,00H
	LD	DE,M5CD8
	LD	HL,M5D00
	LDIR
M52CC	LD	HL,M5858	; ask "MASTER PASSWORD ?"
	CALL	M429A
	LD	HL,M5D00
	LD	B,08H
	CALL	M0040
	LD	A,B
	OR	A
	JR	Z,M52CC
	EX	DE,HL
	ADD	A,E
	LD	L,A
	LD	A,D
	ADC	A,00H
	LD	H,A
	LD	A,08H
	SUB	B
	LD	B,A
M52E9	LD	(HL),' '
	INC	HL
	DJNZ	M52E9
	CALL	M52F6
	LD	(M5CCE),HL
	JR	M5322
M52F6	LD	HL,MFFFF
	LD	B,08H
	LD	A,E
	ADD	A,07H
	LD	E,A
	JR	NC,M5302
	INC	D
M5302	LD	A,(DE)
	PUSH	DE
	LD	D,A
	LD	E,H
	LD	A,L
	AND	07H
	RRCA
	RRCA
	RRCA
	XOR	L
	LD	L,A
	LD	H,00H
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	XOR	H
	XOR	D
	LD	D,A
	LD	A,L
	ADD	HL,HL
	XOR	H
	XOR	E
	LD	E,A
	EX	DE,HL
	POP	DE
	DEC	DE
	DJNZ	M5302
	RET
M5322	LD	HL,M5C00
	XOR	A
M5326	LD	(HL),0FCH
	INC	HL
	INC	A
	CP	'#'
	JR	NZ,M5326
M532E	CP	0CBH
	JR	Z,M533E
	LD	(HL),0FFH
	INC	HL
	INC	A
	JR	M532E
M5338	LD	HL,M5963
	CALL	M429A
M533E	LD	HL,M5926	; ask "DO YOU WANT TO LOCK OUT ANY TRACKS ?"
	CALL	M429A
	LD	HL,M5D00
	LD	B,03H
	CALL	M0040
	LD	A,(HL)
	CP	'Y'
	JR	NZ,M539E
	LD	HL,M594C
	CALL	M429A
	LD	HL,M5D00
	LD	B,1EH
	CALL	M0040
M535F	CALL	M5733
	LD	D,E
	CP	'-'
	JR	NZ,M536A
	CALL	M5733
M536A	EX	AF,AF'
	LD	A,D
	OR	A
	JR	Z,M5338
	CP	'#'
	JR	NC,M5338
	LD	A,E
	CP	'#'
	JR	NC,M5338
	SUB	D
	JR	C,M5338
	INC	A
	LD	B,A
	PUSH	HL
	LD	L,D
	LD	H,'\'
M5381	LD	(HL),0FFH
	INC	HL
	DJNZ	M5381
	POP	HL
	EX	AF,AF'
	CP	0DH
	JR	NZ,M535F
	LD	HL,M5979
	CALL	M429A
	LD	HL,M5D00
	LD	B,03H
	CALL	M0040
	LD	A,(HL)
	LD	(M548D),A
M539E	CALL	M5767
	LD	BC,M0000
	CALL	M0060
	LD	A,(M37EC)
	LD	HL,M586B
	BIT	7,A
	JP	NZ,M56AD
	LD	HL,M5896
	BIT	2,A
	JP	Z,M56AD
	LD	HL,M587C
	BIT	6,A
	JP	NZ,M56AD
	LD	BC,M00CD
	LD	HL,M58AB

M53C8	DEC	BC
	LD	A,B
	OR	C
	JP	Z,M56AD
	LD	A,(M37EC)
	AND	02H
	JR	NZ,M53C8
	LD	BC,M199D
	LD	HL,M58C1

M53DB	DEC	BC
	LD	A,B
	OR	C
	JP	Z,M56AD
	LD	A,(M37EC)
	AND	02H
	JR	Z,M53DB
	LD	DE,M0000
	LD	BC,M00BA
	LD	HL,M58AB

M53F1	DEC	BC
	LD	A,B
	OR	C
	JP	Z,M56AD
	INC	DE
	LD	A,(M37EC)
	AND	02H
	JR	NZ,M53F1
	LD	BC,M1720
	LD	HL,M58C1

M5405	DEC	BC
	LD	A,B
	OR	C
	JP	Z,M56AD
	INC	DE
	LD	A,(M37EC)
	AND	02H
	JR	Z,M5405
	LD	HL,MEACB
	ADD	HL,DE
	LD	HL,M58DB	; DISKETTE UNUSABLE! HARD SECTORED!\n
;	JP	NC,M56AD
	NOP
	NOP
	NOP
	CALL	M5767
M5420	LD	BC,M5D00
	LD	DE,M0000
	CALL	M42AA
	CALL	Z,M5B9C
	NOP
	NOP
	NOP
	LD	H,'\'
	LD	L,11H
	LD	C,00H
M5435	LD	A,(HL)
	CP	0FCH
	JR	Z,M5452
	INC	C
	LD	A,C
	RRCA
	LD	A,L
	JR	NC,M5448
	ADD	A,C
	LD	L,A
	CP	'#'
	JR	NZ,M5435
	JR	M544C
M5448	SUB	C
	LD	L,A
	JR	NZ,M5435
M544C	LD	HL,M5998
	JP	M56AD
M5452	LD	A,L
	LD	(M4202),A
	CALL	M5726
	LD	(M59EB),BC
	LD	HL,M59C9
	CALL	M429A
	XOR	A
	LD	(M54B1),A
M5467	LD	A,(M54B1)
	CALL	M5726
	LD	(M5A26),BC
	LD	HL,M5A14
	CALL	M429A
	LD	A,(M54B1)
	LD	B,A
	LD	A,(M4202)
	CP	B
	LD	B,0FAH
	JR	Z,M5495
	LD	L,A
	LD	H,'\'
	LD	A,(HL)
	INC	A
	LD	B,0FBH
	JR	NZ,M5495
	LD	A,00H
M548D	EQU	$-1
	CP	'Y'
	JP	NZ,M5502
	LD	B,0F9H
M5495	LD	A,B
	LD	(M54DB),A
	LD	HL,M5F00
	LD	DE,M576D
	LD	B,0EH
	CALL	M5749
M54A4	LD	B,06H
	LD	C,00H
	CALL	M574B
	LD	C,0FEH
	CALL	M5751
	LD	C,00H
M54B1	EQU	$-1
	CALL	M5751
	LD	C,00H
	CALL	M5751
	LD	A,(DE)
	LD	C,A
	CALL	M5751
	LD	C,01H
	CALL	M5751
	LD	C,0F7H
	CALL	M5751
	LD	C,0FFH
	CALL	M5751
	LD	B,0BH
	CALL	M5749
	LD	B,06H
	LD	C,00H
	CALL	M574B
	LD	C,00H
M54DB	EQU	$-1
	CALL	M5751
	LD	B,00H
	LD	C,0E5H
	CALL	M574B
	LD	C,0F7H
	CALL	M5751
	LD	C,0FFH
	CALL	M5751
	LD	B,0BH
	CALL	M5749
	INC	DE
	LD	A,(DE)
	INC	A
	JR	NZ,M54A4
	LD	B,'['
	CALL	M5749
	CALL	M551F
M5502	LD	A,(M54B1)
	INC	A
	LD	(M54B1),A
	CP	'#'
	JR	Z,M556B
	LD	A,'['
	LD	(M37EC),A
	PUSH	AF
	POP	AF
	PUSH	AF
	POP	AF
M5516	LD	A,(M37EC)
	RRCA
	JR	C,M5516
	JP	M5467
M551F	CALL	M5523
	RET	Z

M5523	CALL	M5767
	LD	BC,M5F00
	LD	HL,M37EC
	LD	(HL),0F4H
	LD	DE,M37EF
	PUSH	BC
	POP	BC
	PUSH	BC
	POP	BC
	DI
	JR	M553B
M5538	RRCA
	JR	NC,M5546
M553B	LD	A,(HL)
	BIT	1,A
	JR	Z,M5538
	LD	A,(BC)
	LD	(DE),A
	INC	BC
	JP	M553B
M5546	LD	A,(HL)
	LD	(HL),0D0H
	LD	HL,M5A29
	BIT	2,A
	JP	NZ,M56AD
	LD	HL,MA100
	ADD	HL,BC
	EX	DE,HL
	LD	HL,MF413
	ADD	HL,DE
	LD	HL,M5A55
;	JP	NC,M56AD	; drive motor too slow
	NOP
	NOP
	NOP
	LD	HL,MF397
	ADD	HL,DE
	LD	HL,M5A7A
;	JP	C,M56AD		; drive motor too fast
	NOP
	NOP
	NOP
	RET

M556B	LD	A,0DH
	CALL	M0033
	LD	D,00H
M5572	LD	L,D
	LD	H,'\'
	LD	A,(HL)
	INC	A
	JP	Z,M55BD
	LD	A,D
	CALL	M5726
	LD	(M5AB0),BC
	LD	E,00H
M5584	PUSH	DE
	LD	A,D
	CALL	M5767
	LD	A,E
	CALL	M5726
	LD	(M5ABB),BC
	LD	HL,M5A9F
	CALL	M429A
	POP	DE
	LD	BC,M5D00
	CALL	M42AA
	LD	HL,M5ABE
	BIT	4,A
	JP	NZ,M5719
	LD	HL,M5ADD
	BIT	3,A
	JP	NZ,M5719
	LD	HL,M5AFC
	BIT	2,A
	JP	NZ,M56AD
	INC	E
	LD	A,E
	CP	0AH
	JP	NZ,M5584
M55BD	INC	D
	LD	A,D
	CP	'#'
	JP	NZ,M5572
	LD	HL,M5C00
	LD	DE,M5C60
	LD	BC,M0023
	LDIR
	LD	HL,M5B28
	CALL	M429A
	LD	HL,M5C00
	LD	A,(HL)
	OR	01H
	LD	(HL),A
	LD	A,(M4202)
	LD	(M57B6),A
	LD	L,A
	LD	H,'\'
	LD	A,(HL)
	INC	A
	JP	Z,M56D1
	LD	(HL),0FFH
	LD	DE,M0000
	LD	BC,M4200
	LD	A,0A8H
	CALL	M56BD
	LD	A,(M37EC)
	AND	'`'
	JP	NZ,M56CB
	LD	BC,M5C00
	LD	A,(M4202)
	LD	D,A
	LD	E,00H
	LD	A,0A9H
	CALL	M56BD
	LD	A,(M37EC)
	AND	'`'
	CP	' '
	JP	NZ,M56CB
	LD	HL,M5D00
M561A	LD	(HL),00H
	INC	L
	JR	NZ,M561A
	LD	(HL),0A2H
	INC	HL
	LD	(HL),','
	DEC	HL
	LD	E,01H
	LD	BC,M5D00
	LD	A,0A9H
	CALL	M56BD
	LD	A,(M37EC)
	AND	'`'
	CP	' '
	JP	NZ,M56CB
	LD	DE,M5D00
	LD	HL,M5780
	LD	BC,M0020
	LDIR
	LD	A,(M4202)
	LD	D,A
	LD	E,02H
	LD	BC,M5D00
	LD	A,0A9H
	CALL	M56BD
	LD	A,(M37EC)
	AND	'`'
	CP	' '
	JP	NZ,M56CB
	LD	HL,M57A0
	LD	DE,M5D00
	LD	BC,M0020
	LDIR
	LD	A,(M4202)
	LD	D,A
	LD	E,03H
	LD	BC,M5D00
	LD	A,0A9H
	CALL	M56BD
	LD	A,(M37EC)
	AND	'`'
	CP	' '
	JP	NZ,M56CB
	LD	HL,M5D00
	LD	B,' '
M5684	LD	(HL),00H
	INC	HL
	DJNZ	M5684
	LD	A,(M4202)
	LD	D,A
	LD	E,04H
M568F	LD	BC,M5D00
	LD	A,0A9H
	CALL	M56BD
	LD	A,(M37EC)
	AND	'`'
	CP	' '
	JP	NZ,M56CB
	INC	E
	LD	A,E
	CP	0AH
	JR	NZ,M568F
	CALL	M5754
	LD	HL,M5B6D
M56AD	CALL	M429A
M56B0	LD	HL,M5B82
	CALL	M429A
M56B6	LD	A,(M3840)
	RRCA
	JR	NC,M56B6
	HALT
M56BD	CALL	M56D7
	JR	NZ,M56CB
	PUSH	BC
	LD	BC,M5D00
	CALL	M42AA
	POP	BC
	RET	Z
M56CB	LD	HL,M5B49
	JP	M56AD
M56D1	LD	HL,M59EE
	JP	M56AD
M56D7	LD	(M56F8),A
	PUSH	BC
	CALL	M56E2
	POP	HL
	RET	Z
	LD	B,H
	LD	C,L
M56E2	LD	(M37EE),DE
	PUSH	DE
	CALL	M5767
	LD	HL,M37EC
	LD	(HL),1BH
	PUSH	AF
	POP	AF
	PUSH	AF
	POP	AF
M56F3	LD	A,(HL)
	RRCA
	JR	C,M56F3
	LD	(HL),00H
M56F8	EQU	$-1
	LD	DE,M37EF
	PUSH	BC
	POP	BC
	PUSH	BC
	POP	BC
	DI
	JR	M5706
M5703	RRCA
	JR	NC,M5711
M5706	LD	A,(HL)
	BIT	1,A
	JR	Z,M5703
	LD	A,(BC)
	LD	(DE),A
M570D	INC	BC
	JP	M5706
M5711	LD	A,(HL)
	AND	'|'
	POP	DE
	RET	Z
	LD	(HL),0D0H
	RET
M5719	PUSH	DE
	CALL	M429A
	POP	DE
	LD	L,D
	LD	H,'\'
	LD	(HL),0FFH
	JP	M55BD
M5726	LD	C,'0'
M5728	SUB	0AH
	JR	C,M572F
	INC	C
	JR	M5728
M572F	ADD	A,':'
	LD	B,A
	RET

M5733	LD	E,00H
M5735	LD	A,(HL)
	INC	HL
	CP	'0'
	RET	C
	CP	':'
	RET	NC
	SUB	'0'
	LD	B,A
	LD	A,E
	ADD	A,A
	ADD	A,A
	ADD	A,E
	ADD	A,A
	ADD	A,B
	LD	E,A
	JR	M5735
M5749	LD	C,0FFH
M574B	CALL	M5751
	DJNZ	M574B
	RET

M5751	LD	(HL),C
	INC	HL
	RET

M5754	CALL	M5767
	LD	A,0BH
	LD	(M37EC),A
	PUSH	AF
	POP	AF
	PUSH	AF
	POP	AF
M5760	LD	A,(M37EC)
	RRCA
	JR	C,M5760
	RET
	
M5767	LD	A,00H
M5768	EQU	$-1
	LD	(M37E1),A
	RET

M576D	NOP
	DEC	B
	LD	BC,M0206
	RLCA
	INC	BC
	EX	AF,AF'
	INC	B
	ADD	HL,BC
	RST	38H
M5778	DB	'        '
M5780	DB	5Eh,0,0,0,0
	DB	'BOOT    SYS'
	DB	60h,7Fh,1Fh,0B2h,5,0,0,0
	DB	0FFh,0FFh,0,0,0,0,0,0
M57A0	DB	5Dh,0,0,0,0
	DB	'DIR     SYS'
	DB	0A7h,1Dh,0F9h,0E5h,0Ah,0
M57B6	DB	11h,1,0FFh,0FFh,0,0,0,0,0,0
M57C0	DB	'FORMAT INVALID DURING PROGRAM CHAINING!',13
M57E8	DB	1Ch,1Fh,'M1 FLOPPY 80, TRSDOS FORMAT 2.3  ',13,10
M580E	DB	'WHICH DRIVE IS TO BE USED ? ',3
M582B	DB	'DISKETTE NAME ? ',3
M583C	DB	'CREATION DATE (MM/DD/YY) ? ',3
M5858	DB	'MASTER PASSWORD ? ',3
M586B	DB	'DRIVE NOT READY!',13
M587C	DB	'WRITE PROTECTED DISKETTE!',13
M5896	DB	'DRIVE NOT IN SYSTEM!',13
M58AB	DB	'NO DISKETTE IN DRIVE!',13
M58C1	DB	'DOOR NOT CLOSED ON DRIVE!',13
M58DB	DB	'DISKETTE UNUSABLE! HARD SECTORED!',13
M58FD	DB	'DISKETTE CONTAINS DATA, FORMAT OR NOT ? ',3
M5926	DB	'DO YOU WANT TO LOCK OUT ANY TRACKS ? ',3
M594C	DB	'WHICH TRACKS (1-34) ? ',3
M5963	DB	'INVALID TRACK NUMBER!',13
M5979	DB	'FORMAT THE LOCKED OUT TRACKS? ',3
M5998	DB	10,'CAN',27h,'T FORMAT, NO TRACKS AVAILABLE FOR DIRECTORY!',13
M59C9	DB	'DIRECTORY WILL BE PLACED ON TRACK '
M59EB	DB	'00',13
M59EE	DB	'CAN',27h,'T FORMAT, DIRECTORY TRACK FLAWED!',13
M5A14	DB	1Dh,'FORMATTING TRACK '
M5A26	DB	'00',3
M5A29	DB	10,'CAN',27h,'T FORMAT, DISK TRANSFER RATE TOO FAST!',13
M5A55	DB	10,'CAN',27h,'T FORMAT, MOTOR SPEED TOO SLOW!',13
M5A7A	DB	10,'CAN',27h,'T FORMAT, MOTOR SPEED TOO FAST!',13
M5A9F	DB	1Dh,'VERIFYING TRACK '
M5AB0	DB	'00'
M5AB2	DB	', SECTOR '
M5ABB	DB	'00',3
M5ABE	DB	': NOT FOUND! TRACK LOCKED OUT!',13
M5ADD	DB	10,'CRC ERROR! TRACK LOCKED OUT!',13
M5AFC	DB	10,'CAN',27h,'T VERIFY, DISK TRANSFER RATE TOO FAST!',13
M5B28	DB	10,'INITIALIZING SYSTEM INFORMATION',13
M5B49	DB	10,'CAN',27h,'T INITIALIZE SYSTEM INFORMATION',13
M5B6D	DB	10,'FORMATTING COMPLETE',13
M5B82	DB	10,'HIT ',27h,'ENTER',27h,' TO CONTINUE',13
	ORG	5CCBH
	LD	HL,M0000
M5CCE	DB	0,0
M5CD0	DB	'        '
M5CD8	DB	'MM/DD/YY',13
	DB	'               '
	DB	'        '
M5CF8	DB	'        '

	ORG	5E00H
M5E00	NOP
	CP	00H
	DI
	LD	SP,M41FC
	LD	HL,M42E2
	CALL	M429A
	LD	A,01H
	LD	(M37E1),A
	LD	A,(M4202)
	LD	D,A
	LD	E,04H
	LD	BC,M4D00
	CALL	M42AA
	JR	NZ,M5E90
	LD	A,(M4D00)
	AND	10H
	LD	HL,M42E5
	JR	Z,M5E93
	EXX
	LD	HL,(M4D16)
	LD	D,L
	LD	A,H
	RLCA
	RLCA
	RLCA
	AND	07H
	LD	H,A
	RLCA
	RLCA
	ADD	A,H
	LD	E,A
	LD	BC,M4DFF
	EXX
M5E3E	CALL	M4275
	DEC	A
	JR	NZ,M5E5B
	CALL	M4275
	LD	B,A
	CALL	M4275
	LD	L,A
	DEC	B
	CALL	M4275
	LD	H,A
M5E51	DEC	B
	JR	Z,M5E3E
	CALL	M4275
	LD	(HL),A
	INC	HL
	JR	M5E51
M5E5B	DEC	A
	JR	Z,M5E69
	CALL	M4275
	LD	B,A
M5E62	CALL	M4275
	DJNZ	M5E62
	JR	M5E3E
M5E69	CALL	M4275
	CALL	M4275
	LD	L,A
	CALL	M4275
	LD	H,A
	JP	(HL)
	EXX
	INC	C
	JR	NZ,M5E8D
	PUSH	BC
	LD	A,01H
	LD	(M37B6),A
	CALL	M42AA
	JR	NZ,M5E90
	POP	BC
	INC	E
	LD	A,E
	SUB	0AH
	JR	NZ,M5E8D
	LD	E,A
	INC	D
M5E8D	LD	A,(BC)
	EXX
	RET
M5E90	LD	HL,M42F1
M5E93	CALL	M429A
	CALL	M0040
	HALT
	PUSH	HL
M5E9B	LD	A,(HL)
	CP	03H
	JR	Z,M5EA8
	CALL	M0033
	INC	HL
	CP	0DH
	JR	NZ,M5E9B
M5EA8	POP	HL
	RET
	PUSH	BC
	CALL	M42B2
	POP	HL
	RET	Z
	LD	B,H
	LD	C,L
	LD	(M37EE),DE
	LD	HL,M37EC
	LD	(HL),1BH
	PUSH	AF
	POP	AF
	PUSH	AF
	POP	AF
M5EBF	LD	A,(HL)
	RRCA
	JR	C,M5EBF
	LD	(HL),88H
	PUSH	DE
	LD	DE,M37EF
	PUSH	BC
	POP	BC
	JR	M5ED8
M5ECD	RRCA
	JR	NC,M5EDA
M5ED0	LD	A,(HL)
	BIT	1,A
	JR	Z,M5ECD
	LD	A,(DE)
	LD	(BC),A
	INC	BC
M5ED8	JR	M5ED0
M5EDA	LD	A,(HL)
	AND	'\'
	POP	DE
	RET	Z
	LD	(HL),0D0H
	RET
	INC	E
	RRA
	INC	BC
	RLA
	RET	PE
	LD	C,(HL)
	LD	C,A
	JR	NZ,M5F3E
	LD	E,C
	LD	D,E
	LD	D,H
	LD	B,L
	LD	C,L
	DEC	C
	RLA
	RET	PE
	LD	B,H
	LD	C,C
	LD	D,E
	LD	C,E
	JR	NZ,M5F3E
	LD	D,D
	LD	D,D
	LD	C,A
	LD	D,D
	DEC	C
	EX	DE,HL

	; ask "DISKETTE CONTAINS DATA, FORAMT OR NOT ?"
	ORG	5B9CH
	LD	HL,M58FD
	CALL	M429A
	LD	HL,M5D00
	LD	B,01H
	CALL	M0040
	LD	A,(HL)
	CP	'N'
	JP	Z,M5BC0
	CP	'Y'
	JP	NZ,M5B9C
	NOP
	CALL	M5767
	LD	BC,M8000
	CALL	M0060
	RET

	LD	BC,M1000
	CALL	M0060
	JP	M56B0

	END	M5200
